<div class="applications-list">
	@if (loading) {
		<div>Loading applications ...</div>
	}
	@if (error) {
		<div class="error">{{ error }}</div>
	}
	<div class="card-grid">
		@for (app of applications; track app) {
			<div class="app-card" [class.has-errors]="app.errors" [style.opacity]="app.errors ? 0.75 : 1">
				<div class="card-header">
					@if (app.iconContent) {
						<div class="icon-wrapper">
							<img [src]="'data:image/png;base64,' + app.iconContent" [alt]="app.name + ' Icon'" />
						</div>
					}
					<div class="header-info">
						<h2>{{ app.name }}</h2>
						@if (app.description) {
							<p class="app-description">{{ app.description }}</p>
						}
						
					</div>

				</div>
								@if (app.errors) {
									<button type="button" class="show-errors-btn" (click)="app.showErrors = !app.showErrors">
										<span class="error-x">&#10006;</span>
										Show errors
									</button>
									@if (app.showErrors) {
										<div class="error-list-overlay">
											<ul class="error-list-ul">
												<button type="button" class="close-errors-btn" (click)="app.showErrors = false" aria-label="Close error list">&times;</button>
												@for (err of app.errors; track err) {
													<ng-container *ngTemplateOutlet="recursiveError; context: { $implicit: err }"></ng-container>
												}
											</ul>
										</div>
									}
								}

								<ng-template #recursiveError let-err>
									<li>
										{{ err.message }}
										@if (err.details && err.details.length) {
											<ul>
												@for (childErr of err.details; track childErr) {
													<ng-container *ngTemplateOutlet="recursiveError; context: { $implicit: childErr }"></ng-container>
												}
											</ul>
										}
									</li>
								</ng-template>
				<!-- Description now in header -->
				<div class="card-actions">
					<button type="button" (click)="openProxmoxConfigDialog(app)" [disabled]="app.errors">Configure</button>
				</div>
			</div>
		}
	</div>
